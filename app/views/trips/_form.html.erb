<%# app/views/trips/_form.html.erb %>

<%# Stimulusコントローラー 'file-preview' を有効化 %>
<%= form_with model: trip, local: true, class: "space-y-5", data: { controller: "file-preview" } do |f| %>

  <%= render 'shared/error_messages', resource: trip %>

  <%# --- 1. タイトル --- %>
  <div>
    <%= f.label :title, "旅程のタイトル", class: "block text-sm font-bold text-gray-700 mb-1" %>
    <%= f.text_field :title, placeholder: "例: 夏の北海道旅行", class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <%# --- 2. サムネイル画像アップロードフィールドとプレビュー --- %>
  <div class="space-y-3 pt-2">
    <h3 class="text-sm font-bold text-gray-700">サムネイル画像</h3>

    <%# 画像プレビュー表示エリア %>
    <div id="image-preview" data-file-preview-target="previewContainer" class="mb-2">
      <% if trip.image.attached? %>
        <%# 既存の画像がある場合は表示 %>
        <%= image_tag trip.image, class: "w-full sm:w-64 h-auto rounded-lg shadow-md border border-gray-200 object-cover" %>
      <% else %>
        <%# 画像がない場合のプレースホルダー %>
        <div class="w-full sm:w-64 h-40 bg-gray-100 rounded-lg shadow-sm border border-dashed border-gray-300 flex items-center justify-center text-gray-400 text-sm">
          画像なし
        </div>
      <% end %>
    </div>
    
    <div class="flex items-center gap-4">
      <%# ファイル選択ボタン (見た目) %>
      <%= f.label :image, class: "cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50" do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
        </svg>
        画像を選択
      <% end %>

      <%# 実際のファイルフィールド (非表示にしてラベルと連動) %>
      <%= f.file_field :image, 
                       class: "sr-only",
                       data: { action: "change->file-preview#preview", target: "file-preview.input" } %>

      <%# 画像削除用のチェックボックス (更新時のみ) %>
      <% if trip.image.attached? %>
        <%= f.label :remove_image, class: "flex items-center text-red-600 cursor-pointer" do %>
          <%= f.check_box :remove_image, { class: "rounded border-gray-300 text-red-600 shadow-sm focus:border-red-500 focus:ring-red-500" }, 1, 0 %>
          <span class="ml-2 text-sm">画像を削除する</span>
        <% end %>
      <% end %>
    </div>
  </div>

  <%# --- 3. 日付 --- %>
  <div class="grid grid-cols-2 gap-4">
    <div>
      <%= f.label :start_date, "開始日", class: "block text-sm font-bold text-gray-700 mb-1" %>
      <%= f.date_field :start_date, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
    </div>
    <div>
      <%= f.label :end_date, "終了日", class: "block text-sm font-bold text-gray-700 mb-1" %>
      <%= f.date_field :end_date, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
    </div>
  </div>

  <%# --- 4. 総予算 --- %>
  <div>
    <%= f.label :total_budget, "総予算 (円)", class: "block text-sm font-bold text-gray-700 mb-1" %>
    <%= f.number_field :total_budget, placeholder: "50000", class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <%# --- 5. テーマ --- %>
  <div>
    <%= f.label :travel_theme, "旅行のテーマ", class: "block text-sm font-bold text-gray-700 mb-1" %>
    <%= f.select :travel_theme, ['温泉重視', '食体験重視', 'アクティビティ重視', 'リラックス', '観光スポット巡り', 'その他'], { prompt: "選択してください" }, class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
  </div>

  <%# --- 6. 送信ボタン --- %>
  <div class="pt-4">
    <%= f.submit btn_text, class: "w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition shadow-sm cursor-pointer" %>
  </div>

<% end %>